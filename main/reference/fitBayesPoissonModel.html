<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit an MCMC Poisson Model to Site-specific Event Rates — fitBayesPoissonModel • rbqmR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit an MCMC Poisson Model to Site-specific Event Rates — fitBayesPoissonModel"><meta property="og:description" content="Given a set of event data for multiple sites, fit a Bayesian hierarchical
Poisson model to the site-specific event rates."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rbqmR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit an MCMC Poisson Model to Site-specific Event Rates</h1>
    
    <div class="hidden name"><code>fitBayesPoissonModel.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Given a set of event data for multiple sites, fit a Bayesian hierarchical
Poisson model to the site-specific event rates.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fitBayesPoissonModel</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  events <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  exposure <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  inits <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nChains <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">inits</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">inits</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>the data frame containing the <code>eventVar</code> and <code>exposureVar</code> columns</p></dd>


<dt>events</dt>
<dd><p>The number of events per site. If <code>NULL</code> the "posterior"
distribution will be MCMC samples from the prior.</p></dd>


<dt>exposure</dt>
<dd><p>The exposure per site. If <code>NULL</code> the "posterior"
distribution will be MCMC samples from the prior.</p></dd>


<dt>model</dt>
<dd><p>The character string containing the JAGS model to be fitted.  If
<code>NULL</code>, obtained from <code>getModelString("binomial)</code>.</p></dd>


<dt>inits</dt>
<dd><p>A list of JAGS inits lists suitable for use with this model.  If
<code>NULL</code> (the default), <code>nChains</code> random inits are generated by
<code><a href="dot-createPoissonInit.html">.createPoissonInit</a></code>.</p></dd>


<dt>nChains</dt>
<dd><p>The number of chains to use.  Default 2.  If <code>inits</code> is not
<code>NULL</code>, must equal <code>length(inits)</code> or be <code>NULL</code>.</p></dd>


<dt>...</dt>
<dd><p>passed to <code>.createPoissonInit</code> or <code>.autorunJagsAndCaptureOutput</code></p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A tibble with four columns</p>
<dl><dt>lambda</dt>
<dd><p>Simulated values from the posterior distribution of the rates.</p></dd>

<dt>shape</dt>
<dd><p>Simulated values from the posterior distribution of the shape.</p></dd>

<dt>scale</dt>
<dd><p>Simulated values from the posterior distribution of the scale.</p></dd>

<dt>q</dt>
<dd><p>Percentile in each which lambda value falls.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Adverse events at a given site are assumed to follow a Poisson
distribution, a standard statistical distribution that expresses the
probability of a given number of events in a fixed time interval.
The probability depends on a site-specific rate parameter
\(\lambda_i\) multiplied by the exposure (total time on
treatment for all patients at that site).
The site-specific event rates, \(\lambda_i\),
are assumed to follow a Gamma distribution; a positive continuous
distribution with two parameters, shape and scale, that determine the
average rate and how spread the probability of different rates is
around that average.
Uncertainty in the shape and scale of this distribution is accounted for by
specifying prior distributions on these parameters. These "hyper-priors" are
also specified as Gamma distributions.</p>
<p>The parameters of the hyper-priors are specified by <code>shape</code> and <code>scale</code>.
The default settings specify Gamma(1, 1) distributions which are equivalent
to Exp(1) distributions.</p>
<p>The Bayesian Hierarchical Model then estimates the posterior distribution
for the unknown parameters \(\lambda_i\), scale and shape,
given the observed events. Under Bayes Theorem this is proportional to the
likelihood of the observed data given the parameters multiplied by the prior
for the parameters. The prior can be informed by historical data and/or
expert knowledge. As more data are available, the posterior is less
influenced by the prior and more influenced by the data.</p>
<p>The exact posterior distribution cannot be computed directly, hence a Markov
Chain Monte Carlo (MCMC) method is used to simulate values of
\(\lambda_i\), scale and shape from the posterior distribution.
Two Markov chains are used, with a minimum of 10,000 values simulated after
4000 burnin iterations and 1000 adaptive iterations. The chains are checked
for convergence and the simulation is extended if required to meet
convergence diagnositics. The samples from both chains are combined in the
returned value.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load example site rates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">siteRates</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit MCMC Poisson model with default hyperpriors (basis 1 month)</span></span></span>
<span class="r-in"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">siteRates</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">fitBayesPoissonModel</span><span class="op">(</span><span class="va">Events</span>, <span class="va">Exposure</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by John Kirkpatrick.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

